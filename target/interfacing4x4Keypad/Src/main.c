/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * <h2><center>&copy; Copyright (c) 2019 STMicroelectronics.
 * All rights reserved.</center></h2>
 *
 * This software component is licensed by ST under BSD 3-Clause license,
 * the "License"; You may not use this file except in compliance with the
 * License. You may obtain a copy of the License at:
 *                        opensource.org/licenses/BSD-3-Clause
 *
 ******************************************************************************
 */

#if !defined(__SOFT_FP__) && defined(__ARM_FP)
  #warning "FPU is not initialized, but the project is compiling for an FPU. Please initialize the FPU before use."
#endif

#include <stdio.h>
#include <stdint.h>

void delay (void) {
	for (int i = 0; i < 300000; i++);
}

int main(void)
{
	uint32_t volatile *const pClkCtrlReg = (uint32_t*) 0x40023830;
	uint32_t volatile *const pPortCModeReg = (uint32_t*) 0x40020800;
	uint32_t volatile *const pPortCOutReg = (uint32_t*) 0x40020814;
	uint32_t volatile *const pPortCInReg = (uint32_t*) 0x40020810;
	uint32_t volatile *const pPortCpUpDReg = (uint32_t*) 0x4002080C;

	*pClkCtrlReg |= (0 << 2); // 1 for enabling clk for port c

	*pPortCModeReg &= 0xFFFF0000;
	*pPortCModeReg |= 0x00000055;

	*pPortCpUpDReg &= 0xFFFF0000;
	*pPortCpUpDReg |= 0xFFFF5500;

	uint8_t pinStatus;
	int i;
	while(1) {

		for (i = 0; i < 4; i++) {

			*pPortCOutReg |= (15 << 0);
			*pPortCOutReg = *pPortCOutReg &~ (1 << i);

			pinStatus = (uint8_t) *pPortCInReg & (1 << 4);
			if (!pinStatus) {
				if (i == 0) {
					delay();
					printf("1\n");
				} else if (i == 1) {
					delay();
					printf("4\n");
				} else if (i == 2) {
					delay();
					printf("7\n");
				} else if (i == 3) {
					delay();
					printf("*\n");
				}
			}


			pinStatus = (uint8_t) *pPortCInReg & (1 << 5);
			if (!pinStatus) {
				if (i == 0) {
					delay();
					printf("2\n");
				} else if (i == 1) {
					delay();
					printf("5\n");
				} else if (i == 2) {
					delay();
					printf("8\n");
				} else if (i == 3) {
					delay();
					printf("0\n");
				}
			}


			pinStatus = (uint8_t) *pPortCInReg & (1 << 6);
			if (!pinStatus) {
				if (i == 0) {
					delay();
					printf("3\n");
				} else if (i == 1) {
					delay();
					printf("6\n");
				} else if (i == 2) {
					delay();
					printf("9\n");
				} else if (i == 3) {
					delay();
					printf("#\n");
				}
			}


			pinStatus = (uint8_t) *pPortCInReg & (1 << 7);
			if (!pinStatus) {
				if (i == 0) {
					delay();
					printf("A\n");
				} else if (i == 1) {
					delay();
					printf("B\n");
				} else if (i == 2) {
					delay();
					printf("C\n");
				} else if (i == 3) {
					delay();
					printf("D\n");
				}
			}
		}

		i = 0;
	}
}
